<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="IdkChat - simple and minimalistic chat app.">
    <meta name="keywords" content="idkchat,chat,simple,minimalistic,real-time">
    <meta name="author" content="IdkChat">
    <title>IdkChat</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="js/theme.js"></script>
</head>
<body class="theme-dark">
    <main class="content content-dialogs grid-container" style="height: 90vh;">
        <div class="dialogs-list">
            <ul class="dialogs" id="dialogs"></ul>
        </div>

        <div class="dialog-title">
            Username
        </div>

        <div class="messages-list">
            <ul class="messages" id="messages"></ul>
        </div>

        <div class="dialog-input">
            <input type="text" name="message" placeholder="Text..." id="message-input">
        </div>
        <div class="dialog-send-button">
            <button onclick="sendMessage();">Send</button>
        </div>
    </main>
    <footer class="footer text-center">
        <p>IdkChat 2022</p>
        Support: <a href="mailto:idkchat@pepega.ml">idkchat@pepega.ml</a>
    </footer>

    <a href="#" class="toggle-theme-btn" onclick="toggleTheme();">
        <span>T</span>
    </a>

    <script type="text/javascript">
        if (localStorage.getItem('theme') === 'light') {
            setTheme('light');
        } else {
            setTheme('dark');
        }
    </script>

    <script type="application/javascript">
        const dialogs = document.getElementById("dialogs");
        const messages = document.getElementById("messages");
        const message_input = document.getElementById("message-input");

        function addDialog(username, avatar_url) {
            let dialog = document.createElement("li");
            dialog.classList.add("dialog");

            let avatar_img = document.createElement("img");
            avatar_img.src = avatar_url;
            avatar_img.width = 32;
            avatar_img.height = 32;

            let name = document.createElement("span");
            name.innerText = username;

            dialog.appendChild(avatar_img);
            dialog.innerHTML += "\n";
            dialog.appendChild(name);

            dialogs.appendChild(dialog);
        }

        function clearMessages() {
            messages.innerHTML = "";
        }

        function addMessage(type, text, time) {
            let message = document.createElement("li");
            message.classList.add(type === 0 ? "my-message" : "message");

            let date = new Date(time);
            let timestamp = document.createElement("span");
            timestamp.classList.add("message-time");
            timestamp.innerText = `[${padDate(date.getDay())}.${padDate(date.getMonth())}.${date.getFullYear()} ${padDate(date.getHours())}:${padDate(date.getMinutes())}]`;

            let message_text = document.createElement("span");
            message_text.innerText = text;

            message.appendChild(type === 0 ? message_text : timestamp);
            message.innerHTML += "\n";
            message.appendChild(type === 0 ? timestamp : message_text);

            messages.appendChild(message);
            messages.scrollTo(0, messages.scrollHeight);
        }

        function padDate(d) {
            return ("0"+d).slice(-2)
        }

        async function sendMessage() {
            let text = message_input.value.trim();
            if(!text)
                return;
            // TODO: Send message to server

            // But for now simply add message
            addMessage(0, text, Date.now());
            message_input.value = "";
        }

        message_input.addEventListener("keyup", ({key}) => {
            if(key === "Enter") {
                sendMessage();
            }
        });

        for(let i = 0; i < 30; i++) {
            addDialog(`Username ${i}`, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNMafj/HwAGFwLkTJBHPQAAAABJRU5ErkJggg==");
        }

        for(let i = 0; i < 200; i++) {
            addMessage(1, "Text asd qwe ", 1680859800000);
        }
    </script>
</body>
</html>